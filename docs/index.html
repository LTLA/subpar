<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>subpar: Substitutable parallelization for C++ libraries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">subpar
   </div>
   <div id="projectbrief">Substitutable parallelization for C++ libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Substitutable parallelization for C++ libraries </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/LTLA/subpar/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/LTLA/subpar/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/LTLA/subpar"><img src="https://codecov.io/gh/LTLA/subpar/branch/master/graph/badge.svg?token=GByG4StuqU" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This repository implements a simple <code>parallelize_range()</code> function that can be used throughout all of my C++ libaries. By default, it just splits the range of tasks into equi-sized intervals that are executed by different workers. OpenMP is used if it is available, otherwise we spin up a new <code>std::thread</code> for each interval. Advanced users can define a macro to instruct <code>parallelize_range()</code> to use their own parallelization mechanism. This allows applications to quickly substitute all instances of <code>parallelize_range()</code> across all libraries with something more appropriate.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>The <code><a class="el" href="namespacesubpar.html#a9c64cc17f4f8d1fadbba6d25053a8dbe" title="Parallelize a range of tasks across multiple workers.">subpar::parallelize_range()</a></code> function requires the number of workers, the number of tasks, and a function that iterates over the range of tasks and executes them in a single worker.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="subpar_8hpp.html">subpar/subpar.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="namespacesubpar.html#a9c64cc17f4f8d1fadbba6d25053a8dbe">subpar::parallelize_range</a>(</div>
<div class="line">    <span class="comment">/* num_workers = */</span> 10,</div>
<div class="line">    <span class="comment">/* num_tasks = */</span> 12345,</div>
<div class="line">    <span class="comment">/* run = */</span> [&amp;](<span class="keywordtype">int</span> worker, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> len) {</div>
<div class="line">        <span class="comment">// ... do some per-worker set-up ...</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> task = start, end = start + len; task &lt; end; ++task) {</div>
<div class="line">            <span class="comment">// ...process each task ...</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">);</div>
<div class="ttc" id="anamespacesubpar_html_a9c64cc17f4f8d1fadbba6d25053a8dbe"><div class="ttname"><a href="namespacesubpar.html#a9c64cc17f4f8d1fadbba6d25053a8dbe">subpar::parallelize_range</a></div><div class="ttdeci">void parallelize_range(int num_workers, Task_ num_tasks, Run_ run_task_range)</div><div class="ttdoc">Parallelize a range of tasks across multiple workers.</div><div class="ttdef"><b>Definition</b> range.hpp:117</div></div>
<div class="ttc" id="asubpar_8hpp_html"><div class="ttname"><a href="subpar_8hpp.html">subpar.hpp</a></div><div class="ttdoc">Substitutable parallelization functions.</div></div>
</div><!-- fragment --><p><code><a class="el" href="namespacesubpar.html#a9c64cc17f4f8d1fadbba6d25053a8dbe" title="Parallelize a range of tasks across multiple workers.">subpar::parallelize_range()</a></code> functions will correctly handle exceptions thrown in the user-supplied function. This comes with some slight overhead so the user can set the <code>nothrow_</code> template parameter to <code>false</code> if they can guarantee that their supplied functions will not throw.</p>
<p>On occasion, the user has already assigned a task to each worker outside of <b>subpar</b>. This is handled by <code><a class="el" href="namespacesubpar.html#abd9eeb2cbaaf14382b926674c47b9d73" title="Parallelize individual tasks across workers.">subpar::parallelize_simple()</a></code>, which will execute each task in its own worker without the overhead of task range partitioning.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="subpar_8hpp.html">subpar/subpar.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="namespacesubpar.html#abd9eeb2cbaaf14382b926674c47b9d73">subpar::parallelize_simple</a>(</div>
<div class="line">    <span class="comment">/* num_tasks = */</span> 4,</div>
<div class="line">    <span class="comment">/* run = */</span> [&amp;](<span class="keywordtype">int</span> task) {</div>
<div class="line">        <span class="comment">// ...process each task ...</span></div>
<div class="line">    }</div>
<div class="line">);</div>
<div class="ttc" id="anamespacesubpar_html_abd9eeb2cbaaf14382b926674c47b9d73"><div class="ttname"><a href="namespacesubpar.html#abd9eeb2cbaaf14382b926674c47b9d73">subpar::parallelize_simple</a></div><div class="ttdeci">void parallelize_simple(Task_ num_tasks, Run_ run_task)</div><div class="ttdoc">Parallelize individual tasks across workers.</div><div class="ttdef"><b>Definition</b> simple.hpp:50</div></div>
</div><!-- fragment --><p>Check out the <a href="https://ltla.github.io/subpar">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Custom parallelization</h1>
<p>If the <code>SUBPAR_CUSTOM_PARALLELIZE_RANGE</code> function-like macro is defined, it is used in place of the default behavior whenever <code><a class="el" href="namespacesubpar.html#a9c64cc17f4f8d1fadbba6d25053a8dbe" title="Parallelize a range of tasks across multiple workers.">subpar::parallelize_range()</a></code> is called. The macro should accept exactly the same arguments as <code><a class="el" href="namespacesubpar.html#a9c64cc17f4f8d1fadbba6d25053a8dbe" title="Parallelize a range of tasks across multiple workers.">subpar::parallelize_range()</a></code>, but the macro author is now responsible for distributing tasks among workers. This can be used to inject other parallelization mechanisms like Intel's TBB, TinyThread, Boost, etc. The same approach can be applied to <code><a class="el" href="namespacesubpar.html#abd9eeb2cbaaf14382b926674c47b9d73" title="Parallelize individual tasks across workers.">subpar::parallelize_simple()</a></code> via the <code>SUBPAR_CUSTOM_PARALLELIZE_SIMPLE</code> macro.</p>
<p>Users can additionally define the <code>SUBPAR_CUSTOM_PARALLELIZE_RANGE_NOTHROW</code> or <code>SUBPAR_CUSTOM_PARALLELIZE_SIMPLE_NOTHROW</code> macros. These will be used in place of their non-<code>NOTHROW</code> counterparts in the <code>nothrow_ = true</code> case, providing an optimization opportunity for custom parallelization schemes when exception handling is not required. Note that the non-<code>NOTHROW</code> macros still need to be defined before the <code>NOTHROW</code> macros can be used, even if all calls to <b>subpar</b> functions use <code>nothrow_ = true</code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
CMake with &lt;tt&gt;FetchContent&lt;/tt&gt;</h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  subpar</div>
<div class="line">  GIT_REPOSITORY https://github.com/LTLA/subpar</div>
<div class="line">  GIT_TAG master # or any version of interest </div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(subpar)</div>
</div><!-- fragment --><p>Then you can link to <b>subpar</b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe subpar)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE subpar)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
CMake with &lt;tt&gt;find_package()&lt;/tt&gt;</h2>
<p>You can install the library by cloning a suitable version of this repository and running the following commands:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DSUBPAR_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>Then you can use <code>find_package()</code> as usual:</p>
<div class="fragment"><div class="line">find_package(ltla_subpar CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE ltla::subpar)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in the <code>include/</code> subdirectory - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
